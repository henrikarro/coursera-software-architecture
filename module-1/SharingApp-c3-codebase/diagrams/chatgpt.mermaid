@startuml
skinparam componentStyle rectangle
title SharingApp (Android) â€“ Component Diagram

'== External environment
component "Android Framework" as AndroidFW
component "Device Storage\n(File system)" as Storage

'== UI layer (Activities/Fragments)
package "UI Layer" {flowchart TB
  subgraph UI[UI Layer]
    A[ItemListActivity]
    B[AddEditItemActivity]
    C[ContactListActivity]
    D[ContactDetailActivity]
  end

  subgraph APP[Application / Use-Case Layer]
    IC[ItemController]
    CC[ContactController]
    LC[LoanController]
  end

  subgraph DOMAIN[Domain Layer]
    I[Item] --> IL[ItemList]
    CT[Contact] --> CL[ContactList]
    L[Loan] --> LL[LoanList]
  end

  subgraph INFRA[Infrastructure]
    FR[FileRepository]
    JS[JsonSerializer]
    IS[ImageStore]
  end

  AFW[Android Framework]
  FS[(Device Storage)]

  %% UI uses services (controllers)
  A --> IC
  B --> IC
  C --> CC
  D --> CC

  %% Controllers manipulate domain
  IC --> I
  IC --> IL
  CC --> CT
  CC --> CL
  LC --> L
  LC --> LL

  %% Controllers require repositories
  IC -.-> FR
  CC -.-> FR
  LC -.-> FR

  %% Infra depends on Android + filesystem
  FR --> JS
  FR --> AFW
  JS --> AFW
  FR --> FS
  IS --> FS
  [ItemListActivity]
  [AddEditItemActivity]
  [ContactListActivity]
  [ContactDetailActivity]
}

'== Application/Use-Case layer (Controllers)
package "Application / Use-Case Layer" {
  [ItemController]
  [ContactController]
  [LoanController]
}

'== Domain layer (Entities & Collections)
package "Domain Layer" {
  [Item]
  [ItemList]
  [Contact]
  [ContactList]
  [Loan]
  [LoanList]
}

'== Persistence / Infrastructure layer
package "Infrastructure" {
  [JsonSerializer]
  [FileRepository]
  [ImageStore]
}

'== Interfaces (provided/required)
interface IItemService
interface IContactService
interface ILoanService
interface IRepository <<storage>>
interface ISerializer

'== Provided interfaces from controllers to UI
[ItemController] -up-|> IItemService
[ContactController] -up-|> IContactService
[LoanController] -up-|> ILoanService

'== Required interfaces from controllers to infra
[ItemController] ..> IRepository : requires
[ContactController] ..> IRepository : requires
[LoanController] ..> IRepository : requires

'== Infra implementations
[FileRepository] -up-|> IRepository
[JsonSerializer] -up-|> ISerializer
[FileRepository] ..> ISerializer : uses

'== UI depends on application services
[ItemListActivity] ..> IItemService
[AddEditItemActivity] ..> IItemService
[ContactListActivity] ..> IContactService
[ContactDetailActivity] ..> IContactService

'== Controllers operate on domain objects
[ItemController] ..> [Item]
[ItemController] ..> [ItemList]
[ContactController] ..> [Contact]
[ContactController] ..> [ContactList]
[LoanController] ..> [Loan]
[LoanController] ..> [LoanList]

'== Infra talks to Android + Storage
[FileRepository] ..> Storage
[ImageStore] ..> Storage
[JsonSerializer] ..> AndroidFW : JSON libs / context
[FileRepository] ..> AndroidFW : Context, I/O APIs

@enduml
